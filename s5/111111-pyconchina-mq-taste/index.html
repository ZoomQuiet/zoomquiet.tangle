<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
<meta name="version" content="S5 1.1" />
<title>MQ解耦应用</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 5951 2009-05-18 18:03:10Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left{
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<script src="ui/freedom/slides.js" type="text/javascript"></script>
<link rel="stylesheet" href="ui/freedom/slides.css"
      type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/freedom/outline.css"
      type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/freedom/print.css"
      type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/freedom/opera.css"
      type="text/css" media="projection" id="operaFix" />
</head>
<body>
<div class="layout">
<div id="controls"></div>
<div id="currentSlide"></div>
<div id="header">

</div>
<div id="footer">
<h1>MQ解耦应用</h1>
<h2><a class="reference external" href="http://code.google.com/p/openbookproject/wiki/ZoomQuiet">Zoom.Quiet</a> v11.11.11 <a class="reference external" href="http://creativecommons.org/licenses/by-nc-sa/2.5/cn/"><img alt="(CC)by-nc-sa 许可证" src="i/icon/cc-byncnd-80x15.png" /></a> 推荐用 <a class="reference external" href="http://www.mozilla.com/firefox/">FireFox</a> 获得最佳游览效果</h2>
</div>
</div>
<div class="presentation">
<div class="slide" id="slide0">
<h1 class="title">MQ解耦应用</h1>

<!-- Definitions of interpreted text roles (classes) for S5/HTML data. -->
<!-- This data file has been placed in the public domain. -->
<!-- Colours
======= -->
<!-- Text Sizes
========== -->
<!-- Display in Slides (Presentation Mode) Only
========================================== -->
<!-- Display in Outline Mode Only
============================ -->
<!-- Display in Print Only
===================== -->
<!-- Display in Handout Mode Only
============================ -->
<!-- Incremental Display
=================== -->
<p>～ 为偷懒而艰苦思考ing (powered by rst2S5)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Authors:</th><td class="field-body"><a class="reference external" href="mailto:zoomquiet+sns&#64;gmai.com">Zoom.Quiet</a></td>
</tr>
<tr class="field"><th class="field-name">URL:</th><td class="field-body"><a class="reference external" href="http://zoomquiet.org/res/s5/111111-pyconchina-mq-taste">http://zoomquiet.org/res/s5/111111-pyconchina-mq-taste</a></td>
</tr>
</tbody>
</table>
<!-- This document has been placed in the CC domain. -->
<!-- 图片定义区 -->

</div>
<div class="slide" id="id4">
<h1>&lt;Zoom.Quiet/&gt;</h1>
<div class="handout container">
<a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<div align="center" class="align-center"><img alt="是也乎,是也乎" class="takahashi align-center" src="i/id/100514-zq-eye.png" style="width: 258.4px; height: 240.0px;" /></div>
<a class="takahashi reference external image-reference" href="http://zoomquiet.org"><div align="center" class="align-center"><img alt="Zoom.Quiet" class="align-center" src="i/map/50ren-ZoomQuiet-s5-v800.png" style="width: 801.0px; height: 182.0px;" /></div>
</a>
</div>
<div class="slide" id="id5">
<h1>&lt;免责/&gt;</h1>
<div class="handout container">
山寨的，非业界公认的，个人体验为基础!   <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi1">参考所有同好行为总结而得</p>
<ul class="takahashi1 simple">
<li>一切资料来自网络互动挖掘</li>
<li>一切想法来自日常学习工作</li>
<li>一切体悟来自各种沟通交流</li>
<li>一切知识来自社区分享印证</li>
<li>一切经验来自个人失败体验</li>
</ul>
<div class="notes container">
<ul class="simple">
<li>免责是必须的，分享是无理由的！</li>
</ul>
</div>
</div>
<div class="slide" id="id6">
<h1>牛妞</h1>
<div class="handout container">
\ (^o^) / 928d</div>
<div align="center" class="align-center"><img alt="表情牛妞" class="align-center" src="i/foto/niuniu110105.jpeg" style="width: 539.0px; height: 539.0px;" /></div>
<div class="notes container">
<ul class="simple">
<li>我的女儿刚刚一岁半,非常牛,,,脾气牛,头脑牛,虽然不会说话,但是已经能指挥我们干活了...</li>
</ul>
</div>
</div>
<div class="slide" id="brief">
<h1>&lt;brief/&gt;</h1>
<div class="handout container">
简单想,简单试,简单用... <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<ul class="takahashi simple">
<li><span class="orange">05' 起因</span></li>
<li><span class="silver">15' 对策</span></li>
<li><span class="silver">15' 实现</span></li>
<li><span class="silver">05'沟通</span></li>
</ul>
<div class="notes container">
<ul class="simple">
<li></li>
</ul>
</div>
</div>
<div class="slide" id="id7">
<h1>起因</h1>
<div class="handout container">
各种杯具的根源 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">复杂</p>
<div class="notes container">
<ul class="simple">
<li>是也乎?</li>
</ul>
</div>
</div>
<div class="slide" id="id8">
<h1>根源在哪儿?!</h1>
<div class="handout container">
多变/前后依赖/矛盾的业务 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">业务</p>
<div class="notes container">
<ul class="simple">
<li>变化的发动者总是业务</li>
</ul>
</div>
</div>
<div class="slide" id="id9">
<h1>为毛有乱来的业务?</h1>
<div class="handout container">
是共军太狡猾 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">设计</p>
<div class="notes container">
<ul class="simple">
<li>业务总是变化,是必然的,而且随着互联的发展越来越快</li>
</ul>
</div>
</div>
<div class="slide" id="id10">
<h1>为毛要乱实现业务?</h1>
<div class="handout container">
<ul class="simple">
<li>没空宏观规划 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></li>
<li>没空回顾整理</li>
<li>没心情...</li>
</ul>
</div>
<p class="takahashi8"><span class="orange">被</span> 开发</p>
<div class="notes container">
<ul class="simple">
<li>可是落实到一个即使很稳定的系统中,也将引发无数问题</li>
<li>因为原先并没有考虑这么多变化</li>
<li>代码/框架/系统,根本没有到可以随机应变的状态</li>
</ul>
</div>
</div>
<div class="slide" id="id11">
<h1>真正的原因?</h1>
<div class="handout container">
经验不足吧 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8"><span class="orange">被</span> 耦合</p>
<div class="notes container">
<ul class="simple">
<li>耦合的代码都是人为引入的!</li>
</ul>
</div>
</div>
<div class="slide" id="id12">
<h1>依赖是种心理反应</h1>
<div class="handout container">
不受控制的功能/代码叠加 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">蔓生</p>
<div class="notes container">
<ul class="simple">
<li>在思想/态度/情绪失控后的乱来</li>
</ul>
</div>
</div>
<div class="slide" id="id13">
<h1>&lt;brief/&gt;</h1>
<div class="handout container">
简单想,简单试,简单用... <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<ul class="takahashi simple">
<li><span class="gray">05' 起因</span></li>
<li><span class="orange">15' 对策</span></li>
<li><span class="silver">15' 实现</span></li>
<li><span class="silver">05'沟通</span></li>
</ul>
<div class="notes container">
<ul class="simple">
<li></li>
</ul>
</div>
</div>
<div class="slide" id="id14">
<h1>对策</h1>
<div class="handout container">
简单的保持需要更加简单的设计 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8"><span class="orange">K</span> ISS</p>
<div class="notes container">
<ul class="simple">
<li>那么从根儿上尝试解决!</li>
</ul>
</div>
</div>
<div class="slide" id="id15">
<h1>复杂的标志性表现</h1>
<div class="handout container">
牵一发动全身 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">乱入</p>
<div class="notes container">
<ul class="simple">
<li>不乱入,就得从一开始,任何一个组件都有一个统一的简单的可行的鲁棒性 结构</li>
</ul>
</div>
</div>
<div class="slide" id="id16">
<h1>功能代码的模块化不解决问</h1>
<div class="handout container">
业务的纠结是根源 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">概念</p>
<div class="notes container">
<ul class="simple">
<li>整理各种概念</li>
</ul>
</div>
</div>
<div class="slide" id="business">
<h1>Business?!</h1>
<div class="handout container">
<ul class="simple">
<li>此&quot;业务&quot;非彼&quot;业务&quot; <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></li>
</ul>
</div>
<p class="takahashi8"><span class="incremental">业务</span></p>
<div class="notes container">
<ul class="simple">
<li>代码要解决实际问题</li>
<li>实际问题以用户故事描述</li>
<li>应对方案就是业务定义</li>
</ul>
</div>
</div>
<div class="slide" id="application">
<h1>Application</h1>
<div class="handout container">
方案的实现应用 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">应用</p>
<div class="notes container">
<ul class="simple">
<li>对业务的支持是映射到各个应用中</li>
</ul>
</div>
</div>
<div class="slide" id="entities">
<h1>Entities</h1>
<div class="handout container">
组成应用的实体 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">实体</p>
<div class="notes container">
<ul>
<li><p class="first">应用一系列 代码/数据 集合构成</p>
<blockquote>
<ul class="simple">
<li>实体代表了分离的数据系列(disjoint sets of data)</li>
<li>每个数据项(datum)只位于一个实体中</li>
<li>实体中的数据决不与其它实体的数据交叉(overlap)</li>
</ul>
</blockquote>
</li>
</ul>
<blockquote>
<ul>
<li><p class="first">考虑实体的:</p>
<blockquote>
<ul class="simple">
<li>分离的序列化范围 Disjoint Scopes of Serializability</li>
<li>唯一标识的实体 Uniquely Keyed Entities</li>
<li>重分区和实体 Repartitioning and Entities</li>
<li>原子事务和实体 Atomic Transactions and Entities</li>
</ul>
</blockquote>
</li>
<li><p class="first">应用程序底层将确保每个实体键值(和实体)位于单一的机器(或群集)上，而不同实体则可能分布在任何地方</p>
</li>
<li><p class="first">实体是操作原子性的边界标志</p>
</li>
</ul>
</blockquote>
</div>
</div>
<div class="slide" id="transactions">
<h1>Transactions</h1>
<div class="handout container">
实体完成的行动是事务 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">事务</p>
<div class="notes container">
<ul class="simple">
<li>对实体的操作是事务</li>
</ul>
</div>
</div>
<div class="slide" id="activities">
<h1>ACTIVITIES</h1>
<div class="handout container">
事务的具体执行 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">活动</p>
<div class="notes container">
<ul class="simple">
<li>对事务的控制/调用/流传 就是活动</li>
<li>活动包含了实体的状态集合</li>
</ul>
</div>
</div>
<div class="slide" id="id17">
<h1>综上想达成的目标效果</h1>
<div class="handout container">
<a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">期待</p>
<div class="notes container">
<ul class="simple">
<li>开发系统的首选原则</li>
</ul>
</div>
</div>
<div class="slide" id="robustness">
<h1>Robustness</h1>
<div class="handout container">
<ul class="simple">
<li>Almost-Infinite Scaling of Applications <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></li>
<li>考虑无限伸缩应用</li>
</ul>
</div>
<p class="takahashi9"><span class="orange">鲁棒</span></p>
<div class="notes container">
<ul class="simple">
<li>稳健性~鲁棒性原是统计学中的一个专门术语</li>
<li>控制论中:是指控制系统在一定（结构，大小）的参数摄动下，维持某些性能的特性</li>
</ul>
</div>
</div>
<div class="slide" id="id18">
<h1>对策基于以下理论</h1>
<div class="handout container">
<a class="reference external" href="http://www.cnblogs.com/RicCC/archive/2008/03/30/life-beyond-distributed-transactions.html">[翻译] 超越分布式事务的方法 - 一个叛逆者的观点 - riccc - 博客园</a> <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">假设</p>
<div class="notes container">
<ul class="simple">
<li>是也乎?</li>
</ul>
</div>
</div>
<div class="slide" id="id19">
<h1>伸缩性与应用的分层无关</h1>
<div class="handout container">
<a class="reference external" href="http://www.cnblogs.com/RicCC/archive/2008/03/30/life-beyond-distributed-transactions.html">[翻译] 超越分布式事务的方法 - 一个叛逆者的观点 - riccc - 博客园</a> <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi9">分层</p>
<div class="notes container">
<ul class="simple">
<li>底层是伸缩相关(scale-aware)的即它们了解这个映射关系</li>
<li>我们假设底层为上层提供了一个伸缩无关的(scale-agnostic)编程抽象</li>
<li>使用它编写应用程序上层代码时无需考虑伸缩问题</li>
</ul>
</div>
</div>
<div class="slide" id="id21">
<h1>事务序列化范畴与伸缩性有关</h1>
<div class="handout container">
<a class="reference external" href="http://www.cnblogs.com/RicCC/archive/2008/03/30/life-beyond-distributed-transactions.html">[翻译] 超越分布式事务的方法 - 一个叛逆者的观点 - riccc - 博客园</a> <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi9">范畴</p>
<div class="notes container">
<ul>
<li><p class="first">全局事务序列化(global transactional serializability)</p>
<blockquote>
<ul class="simple">
<li>2PC(两阶段提交)在某节点不可用时容易阻塞</li>
<li>协议例如Paxos算法，在节点失败时不会阻塞</li>
</ul>
</blockquote>
</li>
</ul>
<blockquote>
<ul class="simple">
<li>现在考虑的是非全局事务</li>
<li>多个分离的事务序列化范围(multiple disjoint scopes of transactional serializability)</li>
</ul>
</blockquote>
</div>
</div>
<div class="slide" id="id23">
<h1>大部分应用使用&quot;至少一次&quot;的消息方式</h1>
<div class="handout container">
At-Least-Once 模式 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi10">1+</p>
<div class="notes container">
<ul class="simple">
<li>问题产生的原因是消息分发与持久化数据的更新不是直接结合在一起</li>
</ul>
</div>
</div>
<div class="slide" id="id24">
<h1>综上</h1>
<div class="handout container">
<a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">原则</p>
<div class="notes container">
<ul class="simple">
<li>开发系统的首选原则</li>
</ul>
</div>
</div>
<div class="slide" id="idempotence">
<h1>Idempotence</h1>
<div class="handout container">
只包含单一安全事务 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">幂等</p>
<div class="notes container">
<ul>
<li><p class="first">识别出所有实体后</p>
</li>
<li><p class="first">明确各级原子性的事务来:</p>
<blockquote>
<ul class="simple">
<li>安全且幂等:        读取</li>
<li>安全不幂等:        查询/修订</li>
<li>幂等不安全:        创建</li>
<li>不安全幂等:    删除</li>
</ul>
</blockquote>
</li>
<li><p class="first">避免: 消息重试(retry)和重新订阅(reorder)</p>
</li>
</ul>
</div>
</div>
<div class="slide" id="id25">
<h1>用消息来协调</h1>
<div class="handout container">
<a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">消息</p>
<div class="notes container">
<ul class="simple">
<li>隔离实体</li>
<li>转移事务</li>
<li>记录/协调/分发活动</li>
</ul>
</div>
</div>
<div class="slide" id="message-oriented-programming">
<h1>Message-oriented programming</h1>
<div class="handout container">
面向消息的编程 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8"><span class="orange">MOP</span></p>
<div class="notes container">
<ul class="simple">
<li>这是 OOP 之后无数 XOP 的又一次概念冷饭</li>
<li>之前体验到的 面向数据编程,在分布式后,推导成了 MOP</li>
<li>当然还有 MOO ~ 面向肌肉的操作</li>
</ul>
</div>
</div>
<div class="slide" id="id26">
<h1>通常系统</h1>
<div class="handout container">
<a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<a class="takahashi8 reference external image-reference" href="http://tangle.zoomquiet.googlecode.com/hg/s5/111111-pyconchina-mq-taste/i/map/flow-nomor.txt"><div align="center" class="align-center"><img alt="i/map/flow-nomor_wsd-napkin.png" class="align-center" src="i/map/flow-nomor_wsd-napkin.png" style="width: 487.2px; height: 397.2px;" /></div>
</a>
<div class="notes container">
<ul class="simple">
<li>是也乎?</li>
</ul>
</div>
</div>
<div class="slide" id="mop">
<h1>MOP系统</h1>
<div class="handout container">
<a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<a class="takahashi8 reference external image-reference" href="http://tangle.zoomquiet.googlecode.com/hg/s5/111111-pyconchina-mq-taste/i/map/flow-mq.txt"><div align="center" class="align-center"><img alt="i/map/flow-mq_wsd-napkin.png" class="align-center" src="i/map/flow-mq_wsd-napkin.png" style="width: 499.4px; height: 504.9px;" /></div>
</a>
<div class="notes container">
<ul class="simple">
<li>是也乎?</li>
</ul>
</div>
</div>
<div class="slide" id="id27">
<h1>常见邮件提醒</h1>
<div class="handout container">
<a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<a class="takahashi8 reference external image-reference" href="http://tangle.zoomquiet.googlecode.com/hg/s5/111111-pyconchina-mq-taste/i/map/mailr-flow-nomor.txt"><div align="center" class="align-center"><img alt="i/map/mailr-flow-nomor_wsd-napkin.png" class="align-center" src="i/map/mailr-flow-nomor_wsd-napkin.png" style="width: 361.5px; height: 496.5px;" /></div>
</a>
<div class="notes container">
<ul class="simple">
<li>是也乎?</li>
</ul>
</div>
</div>
<div class="slide" id="id28">
<h1>MOP邮件提醒</h1>
<div class="handout container">
<a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<a class="takahashi8 reference external image-reference" href="http://tangle.zoomquiet.googlecode.com/hg/s5/111111-pyconchina-mq-taste/i/map/mailr-flow-mq.txt"><div align="center" class="align-center"><img alt="i/map/mailr-flow-mq_wsd-napkin.png" class="align-center" src="i/map/mailr-flow-mq_wsd-napkin.png" style="width: 409.2px; height: 492.8px;" /></div>
</a>
<div class="notes container">
<ul class="simple">
<li>是也乎?</li>
</ul>
</div>
</div>
<div class="slide" id="id29">
<h1>通常业务日志</h1>
<div class="handout container">
<a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<a class="takahashi8 reference external image-reference" href="http://tangle.zoomquiet.googlecode.com/hg/s5/111111-pyconchina-mq-taste/i/map/log-flow-nomor.txt"><div align="center" class="align-center"><img alt="i/map/log-flow-nomor_wsd-napkin.png" class="align-center" src="i/map/log-flow-nomor_wsd-napkin.png" style="width: 406.5px; height: 496.5px;" /></div>
</a>
<div class="notes container">
<ul class="simple">
<li>是也乎?</li>
</ul>
</div>
</div>
<div class="slide" id="id30">
<h1>MOP业务日志</h1>
<div class="handout container">
<a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<a class="takahashi8 reference external image-reference" href="http://tangle.zoomquiet.googlecode.com/hg/s5/111111-pyconchina-mq-taste/i/map/log-flow-mq.txt"><div align="center" class="align-center"><img alt="i/map/log-flow-mq_wsd-napkin.png" class="align-center" src="i/map/log-flow-mq_wsd-napkin.png" style="width: 476.3px; height: 469.7px;" /></div>
</a>
<div class="notes container">
<ul class="simple">
<li>是也乎?</li>
</ul>
</div>
</div>
<div class="slide" id="id31">
<h1>加层</h1>
<div class="handout container">
这次是通用的 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8"><span class="orange">1</span> 板斧</p>
<div class="notes container">
<ul class="simple">
<li>面对复杂问题永远可以通过增加一个抽象层来解决</li>
<li>MOP 之下,永远只多一层!</li>
</ul>
</div>
</div>
<div class="slide" id="id32">
<h1>&lt;brief/&gt;</h1>
<div class="handout container">
简单想,简单试,简单用... <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<ul class="takahashi simple">
<li><span class="gray">05' 起因</span></li>
<li><span class="gray">15' 对策</span></li>
<li><span class="orange">15' 实现</span></li>
<li><span class="silver">05'沟通</span></li>
</ul>
<div class="notes container">
<ul class="simple">
<li></li>
</ul>
</div>
</div>
<div class="slide" id="id33">
<h1>业务原子化</h1>
<div class="handout container">
内部全部 RESTful 接口化 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">前提</p>
<div class="notes container">
<ul class="simple">
<li>eat yself dog food!</li>
<li>好处是每个原子操作都非常非常简单</li>
</ul>
</div>
</div>
<div class="slide" id="id34">
<h1>分级</h1>
<div class="handout container">
可RESTful 的... <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<ul class="incremental takahashi simple">
<li>安全且幂等: 读取</li>
<li>安全不幂等: 查询/修订</li>
<li>幂等不安全: 创建</li>
<li>不安全幂等: 删除</li>
</ul>
<div class="notes container">
<ul class="simple">
<li>eat yself dog food!</li>
<li>好处是每个原子操作都非常非常简单</li>
</ul>
</div>
</div>
<div class="slide" id="id35">
<h1>支撑核心</h1>
<div class="handout container">
尽可能异步化一切 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">MQ</p>
<div class="notes container">
<ul class="simple">
<li>是也乎?</li>
</ul>
</div>
</div>
<div class="slide" id="message">
<h1>Message</h1>
<div class="handout container">
无状态事务的实体键 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8"><span class="orange">M</span> Q</p>
<div class="notes container">
<ul class="simple">
<li>消息可以是任何东西:</li>
</ul>
<blockquote>
<ul class="simple">
<li>数据片段</li>
<li>代码片段</li>
<li>状态</li>
<li>指令</li>
<li>...</li>
</ul>
</blockquote>
</div>
</div>
<div class="slide" id="queue">
<h1>Queue</h1>
<div class="handout container">
FIFO的管道 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">M <span class="orange">Q</span></p>
<div class="notes container">
<ul class="simple">
<li>一个健壮的,基于 http的拥有多种数据结构的栈</li>
</ul>
</div>
</div>
<div class="slide" id="id36">
<h1>Queue的能力</h1>
<div class="handout container">
分支式请求可耐受 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">迸发</p>
<div class="notes container">
<ul class="simple">
<li>即,能自动对缓存进行优化的</li>
</ul>
</div>
</div>
<div class="slide" id="id37">
<h1>Queue的内容</h1>
<div class="handout container">
Atomic Transactions <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">原子性</p>
<div class="notes container">
<ul class="simple">
<li>对操作能进行原子保证的</li>
</ul>
</div>
</div>
<div class="slide" id="id38">
<h1>Queue的监测</h1>
<div class="handout container">
有方法将意外的任务回收 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">可回收</p>
<div class="notes container">
<ul class="simple">
<li>这个要求不太,一般可以自制</li>
</ul>
</div>
</div>
<div class="slide" id="id40">
<h1><a class="reference external" href="http://celeryproject.org/">芹菜</a></h1>
<div class="handout container">
高档MQ选择... <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<ul class="takahashi simple">
<li>纯Py</li>
<li>多后端选择(DB/NoSQL/MQ)</li>
<li>多框架结合</li>
<li>多线程动力(gevent/Eventlet)</li>
<li>...</li>
</ul>
<div class="notes container">
<ul class="simple">
<li>复杂</li>
</ul>
</div>
</div>
<div class="slide" id="celery">
<h1>Celery</h1>
<div class="handout container">
分布式任务/工作 队列 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<a class="takahashi8 reference external image-reference" href="http://celeryproject.org/"><div align="center" class="align-center"><img alt="i/snap/Celery-Overview-v4.jpg" class="align-center" src="i/snap/Celery-Overview-v4.jpg" style="width: 631.2px; height: 469.2px;" /></div>
</a>
<div class="notes container">
<ul class="simple">
<li></li>
</ul>
</div>
</div>
<div class="slide" id="djnago-celery">
<h1>Djnago-celery</h1>
<div class="handout container">
有Django扩展 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<a class="takahashi8 reference external image-reference" href="http://pypi.python.org/pypi/django-celery"><div align="center" class="align-center"><img alt="i/snap/celery_2011-11-23-174734_1021x526_scrot.png" class="align-center" src="i/snap/celery_2011-11-23-174734_1021x526_scrot.png" style="width: 1032.0px; height: 537.0px;" /></div>
</a>
<div class="notes container">
<ul class="simple">
<li></li>
</ul>
</div>
</div>
<div class="slide" id="gearman">
<h1><a class="reference external" href="http://gearman.org"><img align="top" alt="gearman" class="align-top" src="i/logo/gearman80_title.gif" style="width: 480.0px; height: 80.0px;" /></a></h1>
<div class="handout container">
类似的知名作品 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<a class="takahashi8 reference external image-reference" href="http://gearman.org"><div align="center" class="align-center"><img alt="i/snap/gearman_2011-11-23-175608_620x561_scrot.png" class="align-center" src="i/snap/gearman_2011-11-23-175608_620x561_scrot.png" style="width: 631.0px; height: 572.0px;" /></div>
</a>
<div class="notes container">
<ul class="simple">
<li>基于 Perl/RPC...</li>
</ul>
</div>
</div>
<div class="slide" id="document-oriented-nosql">
<h1>面向文档(document-oriented)的NoSQL 数据库</h1>
<div class="handout container">
10gen 团队的魔幻作品! <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<a class="takahashi8 reference external image-reference" href="http://www.mongodb.org/"><div align="center" class="align-center"><img alt="i/logo/logo-mongodb-ondark_h300.png" class="align-center" src="i/logo/logo-mongodb-ondark_h300.png" style="width: 900.0px; height: 300.0px;" /></div>
</a>
<div class="notes container">
<ul class="simple">
<li>这个词是从humongous中截取出来的，其野心不言而明，直指海量数据存储</li>
</ul>
</div>
</div>
<div class="slide" id="id41">
<h1>内存映射机制</h1>
<div class="handout container">
天然自动化缓存调度 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">mmap</p>
<div class="notes container">
<ul class="simple">
<li>内置分布式集群控制,迸发影响可用</li>
</ul>
</div>
</div>
<div class="slide" id="capped-collection">
<h1>capped collection</h1>
<div class="handout container">
天然高速队列配合 <a class="reference external" href="http://blog.nosqlfan.com/html/1986.html">Tailable Cursors</a> <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">定长集</p>
<div class="notes container">
<ul class="simple">
<li>不用计算空间的定长队列</li>
</ul>
</div>
</div>
<div class="slide" id="id42">
<h1>文档级的原子操作</h1>
<div class="handout container">
$findAndModify;相当于表安全 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi7">upset</p>
<div class="notes container">
<ul class="simple">
<li>$upset 也是</li>
</ul>
</div>
</div>
<div class="slide" id="id43">
<h1>使用时间差</h1>
<div class="handout container">
时间戳查询 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">now <span style="color: #666666">=</span> datetime<span style="color: #666666">.</span>datetime<span style="color: #666666">.</span>now()
difference <span style="color: #666666">=</span> datetime<span style="color: #666666">.</span>timedelta(seconds<span style="color: #666666">=10</span>)
timeout <span style="color: #666666">=</span> now <span style="color: #666666">-</span> difference

queue<span style="color: #666666">.</span>find({<span style="color: #BA2121">&#39;inProg&#39;</span> : <span style="color: #008000">True</span>, <span style="color: #BA2121">&#39;start&#39;</span> : {<span style="color: #BA2121">&#39;$lte&#39;</span> : timeout} })
</pre></div>
<div class="notes container">
<ul class="simple">
<li>山寨,但是好用</li>
</ul>
</div>
</div>
<div class="slide" id="id44">
<h1><a class="reference external" href="https://github.com/bcoe/karait">Karait</a></h1>
<div class="handout container">
轻便MQ选择... <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<ul class="takahashi simple">
<li>纯Py</li>
<li>跨语言接口</li>
<li>MongoDB 后端!</li>
</ul>
<div class="notes container">
<ul class="simple">
<li>简陋,但是,作为开始很好用</li>
</ul>
</div>
</div>
<div class="slide" id="python-q">
<h1>Python 入Q</h1>
<div class="handout container">
示例代码 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">karait</span> <span style="color: #008000; font-weight: bold">import</span> Message, Queue
queue <span style="color: #666666">=</span> Queue(
    database<span style="color: #666666">=</span><span style="color: #BA2121">&#39;karait&#39;</span>,
    queue<span style="color: #666666">=</span><span style="color: #BA2121">&#39;messages&#39;</span>,
)
queue<span style="color: #666666">.</span>write({
    <span style="color: #BA2121">&#39;name&#39;</span>: <span style="color: #BA2121">&#39;Benjamin&#39;</span>,
    <span style="color: #BA2121">&#39;action&#39;</span>: <span style="color: #BA2121">&#39;Rock&#39;</span>
    }
    ,routing_key<span style="color: #666666">=</span><span style="color: #BA2121">&#39;foobar&#39;</span>
    )<span style="color: #408080; font-style: italic">#, expire=3.0</span>
</pre></div>
<div class="notes container">
<ul class="simple">
<li>是也乎?</li>
</ul>
</div>
</div>
<div class="slide" id="id45">
<h1>Python 出Q</h1>
<div class="handout container">
示例代码 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">karait</span> <span style="color: #008000; font-weight: bold">import</span> Message, Queue
queue <span style="color: #666666">=</span> Queue()

message <span style="color: #666666">=</span> queue<span style="color: #666666">.</span>read()[<span style="color: #666666">0</span>]
<span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">%</span> (message<span style="color: #666666">.</span>name)

message<span style="color: #666666">.</span>delete()
</pre></div>
<div class="notes container">
<ul class="simple">
<li>是也乎?</li>
</ul>
</div>
</div>
<div class="slide" id="node-js-q">
<h1>node.js 出Q</h1>
<div class="handout container">
示例代码 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">var</span> puts <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;sys&#39;</span>).puts,
    Queue <span style="color: #666666">=</span> require(<span style="color: #BA2121">&#39;karait&#39;</span>).Queue;
<span style="color: #008000; font-weight: bold">new</span> Queue(<span style="color: #008000; font-weight: bold">function</span>(err, queue) {
    (<span style="color: #008000; font-weight: bold">function</span> readMessages() {
        queue.read({routingKey<span style="color: #666666">:</span> <span style="color: #BA2121">&#39;foobar&#39;</span>}, <span style="color: #008000; font-weight: bold">function</span>(err, messages) {
            <span style="color: #008000; font-weight: bold">for</span> (<span style="color: #008000; font-weight: bold">var</span> i <span style="color: #666666">=</span> <span style="color: #666666">0</span>, message; (message <span style="color: #666666">=</span> messages[i]) <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span>; i<span style="color: #666666">++</span>) {
            <span style="color: #408080; font-style: italic">//...</span>
            }
            queue.deleteMessages(messages, <span style="color: #008000; font-weight: bold">function</span>() {
                readMessages();
            });
        })();
    });
</pre></div>
<div class="notes container">
<ul class="simple">
<li>是也乎?</li>
</ul>
</div>
</div>
<div class="slide" id="ruby-q">
<h1>Ruby 出Q</h1>
<div class="handout container">
示例代码 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000">require</span> <span style="color: #BA2121">&#39;karait&#39;</span>

queue <span style="color: #666666">=</span> <span style="color: #880000">Karait</span><span style="color: #666666">::</span><span style="color: #880000">Queue</span><span style="color: #666666">.</span>new
message <span style="color: #666666">=</span> queue<span style="color: #666666">.</span>read()<span style="color: #666666">.</span>first
<span style="color: #008000">print</span> <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">#{</span>message<span style="color: #666666">.</span>name<span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span>

message<span style="color: #666666">.</span>delete
</pre></div>
<div class="notes container">
<ul class="simple">
<li>是也乎?</li>
</ul>
</div>
</div>
<div class="slide" id="id46">
<h1>原子保证</h1>
<div class="handout container">
visibility_timeout 设定超时秒数 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">karait</span> <span style="color: #008000; font-weight: bold">import</span> Message, Queue
queue <span style="color: #666666">=</span> Queue()

message <span style="color: #666666">=</span> queue<span style="color: #666666">.</span>read(routing_key<span style="color: #666666">=</span><span style="color: #BA2121">&#39;foobar&#39;</span>,
    visibility_timeout<span style="color: #666666">=3.0</span>)[<span style="color: #666666">0</span>]
<span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">%</span> (message<span style="color: #666666">.</span>name)

message<span style="color: #666666">.</span>delete
</pre></div>
<div class="notes container">
<ul class="simple">
<li>是也乎?</li>
</ul>
</div>
</div>
<div class="slide" id="id47">
<h1>未尽的</h1>
<div class="handout container">
各种没现成的功能 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">ToDo</p>
<div class="notes container">
<ul class="simple">
<li>MOP 从思想到框架缺少的...</li>
</ul>
</div>
</div>
<div class="slide" id="id48">
<h1>工作状态</h1>
<div class="handout container">
是否超时/死亡/僵尸... <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi7">进程</p>
<p class="takahashi7">监控</p>
<div class="notes container">
<ul>
<li><p class="first">ip:port:start_time:pid 为组合,对进程进行标识:</p>
<blockquote>
<ul class="simple">
<li>pid   确保唯一性</li>
<li>gpid  生成成本低</li>
<li>gpid  有生产意义</li>
<li>gpid  有历史意义</li>
</ul>
</blockquote>
</li>
</ul>
</div>
</div>
<div class="slide" id="id49">
<h1>数据传递</h1>
<div class="handout container">
当事务有前后顺序时? <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi7">活动</p>
<p class="takahashi7">序列</p>
<div class="notes container">
<ul class="simple">
<li>再设计,通过多段提交,去顺序化</li>
</ul>
</div>
</div>
<div class="slide" id="id50">
<h1>灾难响应</h1>
<div class="handout container">
能否安全的迁移所有末尽事务? <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi7">灾难</p>
<p class="takahashi7">迁移</p>
<div class="notes container">
<ul class="simple">
<li>MongoDB 的能力了!</li>
</ul>
</div>
</div>
<div class="slide" id="id51">
<h1>业务状态</h1>
<div class="handout container">
合理化业务整体进展的汇报 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi7">实时</p>
<p class="takahashi7">统计</p>
<div class="notes container">
<ul class="simple">
<li>分布式业务日志内置!</li>
</ul>
</div>
</div>
<div class="slide" id="id52">
<h1>对策</h1>
<div class="handout container">
简单的保持需要更加简单的设计 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">KI <span class="orange">SS</span></p>
<div class="notes container">
<ul class="simple">
<li>那么从根儿上尝试解决!</li>
</ul>
</div>
</div>
<div class="slide" id="kiss">
<h1>KISS</h1>
<div class="handout container">
山寨才V5 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<ul class="incremental takahashi simple">
<li>选择最 <strong>土</strong> 的方案</li>
<li>成对维护 <sup>(生产和消费者)</sup></li>
<li>内置测试</li>
<li>守往master</li>
<li>时常重构 <sup>沈游侠军规</sup></li>
<li>...</li>
</ul>
<div class="notes container">
<ul class="simple">
<li>1、code review 的必须很快,代码排版到能够扫一眼文件就知道有没有 bug 和设计问题</li>
<li>2、当无法起出一个PP的变量名时，已经有设计问题了</li>
</ul>
</div>
</div>
<div class="slide" id="id53">
<h1>&lt;brief/&gt;</h1>
<div class="handout container">
简单想,简单试,简单用... <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<ul class="takahashi simple">
<li><span class="gray">05' 起因</span></li>
<li><span class="gray">15' 对策</span></li>
<li><span class="gray">15' 实现</span></li>
<li><span class="orange">05'沟通</span></li>
</ul>
<div class="notes container">
<ul class="simple">
<li></li>
</ul>
</div>
</div>
<div class="slide" id="id54">
<h1>总之:任何好想法</h1>
<div class="handout container">
期望记住的~单位时间能记住的只有7+-2 个 <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<ul class="incremental takahashi simple">
<li>复杂事关态度</li>
<li>耦合的根源在业务</li>
<li>异步业务靠设计</li>
<li>MQ我选MongoDB</li>
<li><span class="incremental">MOP</span> 尚未成功</li>
</ul>
<div class="notes container">
<ul class="simple">
<li>Doing now! don't thinking!</li>
</ul>
</div>
</div>
<div class="slide" id="id55">
<h1>&lt;版本/&gt;</h1>
<div class="handout container">
<a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<ul class="simple">
<li>111201 增补ToDo 和牛妞照片</li>
<li>111122 增补图谱</li>
<li>111114 增补叙述</li>
<li>111112 调整结构</li>
<li>111111 创建幻灯</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">反馈:</th><td class="field-body"><a class="reference external" href="mailto:zoomquiet+sns&#64;gmai.com">Zoom.Quiet</a></td>
</tr>
</tbody>
</table>
<p><a class="reference external" href="http://zoomquiet.org/res/s5/111111-pyconchina-mq-taste">http://zoomquiet.org/res/s5/111111-pyconchina-mq-taste</a></p>
</div>
<div class="slide" id="id56">
<h1><a class="reference external" href="http://www.meyerweb.com/eric/tools/s5/">S5</a></h1>
<div class="handout container">
纯HTML 幻灯撰写框架!... <a class="reference external" href="http://www.meyerweb.com/eric/tools/s5/"><img align="top" alt="S5icon" class="align-top" src="pix/S5icon.GIF" style="width: 16.0px; height: 16.0px;" /></a></div>
<ul class="simple">
<li>S<sup>5</sup>== a <span class="orange">S</span> imple <span class="orange">S</span> tandards-Based <span class="orange">S</span> lide <span class="orange">S</span> how <span class="orange">S</span> ystem</li>
</ul>
<blockquote>
<ul class="simple">
<li>仅仅依靠 CSS+JS 的HTML格式幻灯演示框架</li>
</ul>
</blockquote>
<ul class="simple">
<li>我的编辑环境: <a class="reference external" href="http://wiki.woodpecker.org.cn/moin/LeoEnvironment"><img align="top" alt="LeoProse" class="align-top" src="pix/LeoProse.gif" style="width: 81.0px; height: 42.0px;" /></a> ~ <a class="reference external" href="http://en.wikipedia.org/wiki/Literate_programming">文学化编辑器</a></li>
</ul>
<a class="reference external image-reference" href="http://wiki.woodpecker.org.cn/moin/LeoEnvironment"><div align="center" class="align-center"><img alt="pix/2010-01-18-230729_605x421_leo.png" class="align-center" src="pix/2010-01-18-230729_605x421_leo.png" style="width: 605.0px; height: 421.0px;" /></div>
</a>
<div class="notes container">
<ul class="simple">
<li>虽然有很多其它替代方案，至今用得最爽的还是 S5</li>
<li>最好也是最不好的，就是S5 需要专用的http 空间发布，无法直接分享到 slidshare.com 之类SNS空间中</li>
</ul>
</div>
</div>
<div class="slide" id="discuss">
<h1>&lt;discuss/&gt;</h1>
<div class="handout container">
<a class="reference external" href="http://wiki.woodpecker.org.cn/moin/ZoomQuiet"><img alt="是也乎;-)" src="i/id/logo-PyCon2011China-h50.png" /></a></div>
<p class="takahashi8">Q&amp;A</p>
<div class="notes container">
<ul class="simple">
<li></li>
</ul>
</div>
</div>
</div>
</body>
</html>
